<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Restaurant Management System</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="admin.css">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <a class="navbar-brand" href="#">Admin Dashboard</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#ongoingTablesSection">Ongoing Tables</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#manageTablesSection">Manage Tables</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#manageItemsSection">Manage Menu Items</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container mt-5">
        <h1 class="text-center">Restaurant Admin Dashboard</h1>

        <!-- Ongoing Tables Section -->
        <section id="ongoingTablesSection">
            <h2 class="mt-5">Ongoing Tables</h2>
            <ul id="ongoingTablesList" class="list-group">
                <% ongoingTables.forEach(table => { %>
                    <li class="list-group-item d-flex flex-column">
                        <div class="table-details d-flex justify-content-between align-items-center">
                            <div>
                                <span><strong>Table Number:</strong> <%= table.Table_Number %></span><br>
                                <span><strong>Status:</strong> <%= table.Status %></span><br>
                                <span><strong>Total Quantity:</strong> <%= table.Total_Quantity %></span><br>
                                <span><strong>Total Revenue:</strong> ₹<%= table.Total_Amount %></span>
                            </div>
                            <div>
                                <a href="/ShowItems<%= table.Table_Number %>">
                                    <button class="btn btn-info btn-sm mr-2">Show Items</button>
                                </a>
                                <button class="btn btn-danger btn-sm" onclick="EndTable(event)" data-id="<%= table._id %>">CheckOut</button>
                            </div>
                        </div>
                    </li>
                <% }) %>
            </ul>
        </section>

        <!-- Manage Tables Section -->
        <section id="manageTablesSection">
            <h2>Manage Tables</h2>
            <div id="addTableFormContainer">
                <div class="form-group">
                    <label for="tableName">Table Name:</label>
                    <input type="text" class="form-control" id="tableName" required>
                </div>
                <div id="qrcode"></div>
                <button id="submitButton" class="btn btn-primary" onclick="AddTable()">Add Table</button>
            </div>

            <h3 class="mt-4">Existing Tables</h3>
            <ul id="tablesList" class="list-group">
                <% tables.forEach(table => { %>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span>Table Number: <%= table.Number %></span>
                        <span>Total Revenue: <%= table.Total_Revenue %></span>
                        <span>Status: <%= table.Status %></span>
                        <div>
                            <button class="btn btn-primary btn-sm" onclick="generateQRCode('<%= table.Number %>')">QR code</button>
                            <button class="btn btn-danger btn-sm">Delete</button>
                            <button class="btn btn-warning btn-sm">Update</button>
                        </div>
                    </li>
                    <a href="" id="qrcodeurl<%= table.Number %>" target="_blank"></a>
                    <div id="qrcode<%= table.Number %>"></div>
                <% }) %>
            </ul>
        </section>

        <!-- Manage Menu Items Section -->
        <section id="manageItemsSection">
            <h2 class="mt-5">Manage Menu Items</h2>
            <div id="addItemFormContainer">
                <div class="form-group">
                    <label for="itemName">Item Name:</label>
                    <input type="text" class="form-control" id="itemName" required>
                </div>
                <div class="form-group">
                    <label for="itemPrice">Item Price:</label>
                    <input type="number" class="form-control" id="itemPrice" required>
                </div>
                <div class="form-group">
                    <label for="itemDescription">Item Description:</label>
                    <textarea class="form-control" id="itemDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label for="itemImageLink">Image Link:</label>
                    <input type="url" class="form-control" id="itemImageLink" required>
                </div>
                <button id="submitItemButton" class="btn btn-primary" onclick="ItemAdd()">Add Item</button>
            </div>

            <h3 class="mt-4">Existing Menu Items</h3>
            <ul id="itemsList" class="list-group">
                <% items.forEach(item => { %>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span><%= item.Name %> - ₹<%= item.Price.toFixed(2) %></span>
                        <div>
                            <button class="btn btn-danger btn-sm">Delete</button>
                            <button class="btn btn-warning btn-sm">Update</button>
                        </div>
                    </li>
                <% }) %>
            </ul>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script>
        function generateQRCode(tableNumber) {
            const text = `https://your-url/Food-Menu${tableNumber}`;
            const qrcodeContainer = document.getElementById(`qrcode${tableNumber}`);
            const qrcodeurlContainer = document.getElementById(`qrcodeurl${tableNumber}`);
            
            if (qrcodeContainer.innerHTML != '') {
                qrcodeurlContainer.href = '';
                qrcodeurlContainer.innerHTML = '';
                qrcodeContainer.innerHTML = '';
            } else {
                QRCode.toDataURL(text).then(function (url) {
                    const img = document.createElement("img");
                    img.src = url;
                    qrcodeurlContainer.href = text;
                    qrcodeurlContainer.innerHTML = text;
                    qrcodeContainer.appendChild(img);
                }).catch(function (error) {
                    console.error("Error generating QR Code:", error);
                });
            }
        }

        async function AddTable() {
            // Add table function code here
        }
        
        async function ItemAdd() {
            // Add item function code here
        }

        async function EndTable(event) {
            // End table function code here
        }
    </script>
</body>
</html>
