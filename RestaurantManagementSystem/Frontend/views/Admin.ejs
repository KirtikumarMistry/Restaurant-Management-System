<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Restaurant Management System</title>
    <link rel="stylesheet" href="/assets/css/admin.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> -->
</head>

<body>
    <div class="container mt-5">
        <nav class="navbar">
            <a  class="navbar-brand" href="admin/dashboard-data">Admin Dashboard</a>
            <button class="navbar-toggler" onclick="toggleNavbar()">☰</button>
            <div class="navbar-menu" id="navbarNav">
                <ul>
                    <li><a href="OngoingTables">Ongoing Tables</a></li>
                    <li><a href="manageTables">Manage Tables</a></li>
                    <li><a href="manageItems">Manage Menu Items</a></li>
                </ul>
            </div>
        </nav>
        <h1 class="text-center heading-top">Restaurant Admin Dashboard</h1>
        <div class="metric-card">
            <h3>Total Revenue (Today)</h3>
            <p>₹<%= totalRevenueToday.toFixed(2) %></p>
        </div>

        <!-- Total Number of Tables Available / In Use -->
        <div class="metric-card">
            <h3>Total Tables In Use / Available</h3>
            <p><%= tablesInUse %> / <%= totalTables %></p>
        </div>

        <!-- Average Order Value -->
        <div class="metric-card">
            <h3>Average Order Value</h3>
            <p>₹<%= averageOrderValue.toFixed(2) %></p>
        </div>

        <!-- Tables with High Revenue -->
        <div class="metric-card">
            <h3>Top Revenue Tables</h3>
            <ul>
                <% top_rev.forEach(table => { %>
                    <li>Table <%= table.number %>: ₹<%= table.revenue.toFixed(2) %></li>
                <% }) %>
            </ul>
        </div>
    </div>
    </div>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script>
        function toggleNavbar() {
            const navbarNav = document.getElementById("navbarNav");
            navbarNav.classList.toggle("active");
        }
        document.addEventListener("DOMContentLoaded", async () => {
    try {
        const response = await fetch("/admin/dashboard-data"); // Fetch fresh data from the server
        const data = await response.json();

        // Update metrics with the data received from the server
        document.querySelector(".metric-card:nth-child(1) p").textContent = `₹${data.totalRevenueToday.toFixed(2)}`;
        document.querySelector(".metric-card:nth-child(2) p").textContent = data.ongoingTables;
        document.querySelector(".metric-card:nth-child(3) p").textContent = `${data.tablesInUse} / ${data.totalTables}`;
        document.querySelector(".metric-card:nth-child(4) p").textContent = `₹${data.averageOrderValue.toFixed(2)}`;

        const topTablesList = document.querySelector(".metric-card:nth-child(5) ul");
        topTablesList.innerHTML = ""; // Clear the list
        data.topRevenueTables.forEach(table => {
            const li = document.createElement("li");
            li.textContent = `Table ${table.number}: ₹${table.revenue.toFixed(2)}`;
            topTablesList.appendChild(li);
        });
    } catch (error) {
        console.error("Failed to fetch dashboard data:", error);
    }
});
    </script>
</body>

</html>